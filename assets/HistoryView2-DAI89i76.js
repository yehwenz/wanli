import{d as E,u as $,s as J,a as K,b as O,c as Q,r as S,o as X,e as Y,j as Z,f as ee,w as l,p as te,g as d,h as r,i as ae,v as oe,k as o,l as s,m as A,n as u,q as se,F as z,t as _,x as h,y as D,z as le,A as ne,_ as ce}from"./index-DkzAPJNB.js";import{C as M}from"./CounMasterInfo-PZ6IITpm.js";import{u as ie,H as re}from"./TableHeader-CiUJ5xRo.js";import{S as de}from"./SearchText-7uKoE6o6.js";const ue={class:"SearchPosition"},ve={class:"text-center table"},pe={key:1},me={key:2},_e={key:0},he=["colspan"],ge={class:"detail"},xe=["colspan"],Se=["colspan"],ye={colspan:"2",class:"text-end"},fe=E({__name:"HistoryView2",setup(be){const{CTable1:y,CTableMobile1:N}=re(),{axiosIns:w}=$(),{token:P}=J(K()),{StateColor:U,StateText:H,debounce:F}=ie(),f=O(),L=Q(()=>f.xs.value?N:y),v=S([]),b=S(!1);X(()=>{setTimeout(()=>{b.value=!0},600)}),Y(()=>{b.value=!1});const e=S({ItemPerPage:20,ItemsLength:0,Items:[],Loading:!1,Search:"",Title:"已處理列表",Width:"200px",CodeSet:[]}),p=S(1),T=S([]),V={headers:{Authorization:`Bearer ${P.value}`}},G=Z(P.value)["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"],B=async(a,n,C,I)=>{var x;const g={PageIndex:a,PageSize:n,UserName:I,Receiver:G,SortBy:(x=C[0])==null?void 0:x.order};await w.post("Counseling/master/ConsultedTable",g,V).then(m=>{e.value.Items=m.data.counMasterTable,e.value.ItemsLength=m.data.counMasterTableCount}).catch(m=>{console.log(m),e.value.Items=[],e.value.ItemsLength=e.value.Items.length}),e.value.Loading=!1};(async()=>{await w.get("api/CodeSet/CMState",V).then(a=>e.value.CodeSet=a.data).catch(()=>{e.value.CodeSet=[]})})(),te("uploadData",()=>B(p.value,e.value.ItemPerPage,T.value,e.value.Search));const R=a=>{e.value.Loading=!0,e.value.Items=[],j(a)},j=F(a=>{p.value=a.page,e.value.ItemPerPage=a.itemsPerPage,T.value=a.sortBy,B(a.page,a.itemsPerPage,a.sortBy,a.search)},500);return(a,n)=>{const C=d("v-toolbar-title"),I=d("v-toolbar"),g=d("v-btn"),x=d("v-dialog"),m=d("v-pagination"),W=d("v-data-table-server"),q=d("v-container");return r(),ee(q,{fluid:""},{default:l(()=>[ae(o("div",ue,[s(de,{modelValue:e.value.Search,"onUpdate:modelValue":n[0]||(n[0]=t=>e.value.Search=t)},null,8,["modelValue"])],512),[[oe,b.value]]),s(W,{style:{height:"85vh"},items:e.value.Items,expanded:v.value,"onUpdate:expanded":n[2]||(n[2]=t=>v.value=t),page:p.value,"onUpdate:page":n[3]||(n[3]=t=>p.value=t),"items-length":e.value.ItemsLength,"items-per-page":"20","item-value":"cmid",headers:L.value,search:e.value.Search,"onUpdate:options":R,class:"table-sticky",loading:e.value.Loading,"show-expand":_(f).xs.value},{top:l(()=>[s(I,{flat:""},{default:l(()=>[s(C,{class:"font-weight-bold text-center text-sm-h5"},{default:l(()=>[A("已處理申請列表")]),_:1})]),_:1})]),item:l(({item:t})=>[o("tr",ve,[(r(!0),u(z,null,se(L.value,c=>(r(),u("td",{key:c.key},[c.key==="cmState"?(r(),u("span",{key:0,style:ne({color:_(U)(t.cmState)})},h(_(H)(t.cmState,e.value.CodeSet)),5)):c.key==="action"?(r(),u("span",pe,[s(x,{activator:"parent",persistent:"","max-width":"1000px"},{activator:l(({props:i})=>[s(g,D({size:"small",color:"info",text:"查看",ref_for:!0},i),null,16)]),default:l(({isActive:i})=>[s(M,{id:t.cmid,isActive:i.value,onIsActive:k=>i.value=k},null,8,["id","isActive","onIsActive"])]),_:2},1024)])):c.key==="data-table-expand"?(r(),u("span",me,[s(g,{icon:v.value[0]==t.cmid?"mdi-chevron-up":"mdi-chevron-down",variant:"text",size:"small",onClick:()=>v.value[0]==t.cmid?v.value=[]:v.value=[t.cmid]},null,8,["icon","onClick"])])):(r(),u(z,{key:3},[A(h(t[c.key]),1)],64))]))),128))])]),"expanded-row":l(({columns:t,item:c})=>[_(f).xs.value?(r(),u("tr",_e,[o("td",{colspan:t.length,class:"pa-0"},[o("table",ge,[o("tr",null,[o("th",null,h(_(y)[1].title),1),o("td",{colspan:t.length-1},h(c.userName),9,xe)]),o("tr",null,[o("th",null,h(_(y)[2].title),1),o("td",{colspan:t.length-1},h(c.topics),9,Se)]),o("tr",null,[o("td",ye,[s(x,{activator:"parent",persistent:"","max-width":"1000px"},{activator:l(({props:i})=>[s(g,D({size:"small",color:"info",text:"查看"},i),null,16)]),default:l(({isActive:i})=>[s(M,{id:c.cmid,isActive:i.value,onIsActive:k=>i.value=k},null,8,["id","isActive","onIsActive"])]),_:2},1024)])])])],8,he)])):le("",!0)]),bottom:l(()=>[s(m,{modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=t=>p.value=t),length:Math.ceil(e.value.ItemsLength/20),"total-visible":3},null,8,["modelValue","length"])]),_:1},8,["items","expanded","page","items-length","headers","search","loading","show-expand"])]),_:1})}}}),Le=ce(fe,[["__scopeId","data-v-410399c6"]]);export{Le as default};
