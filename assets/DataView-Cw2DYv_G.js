import{H as q,u as E}from"./TableHeader-CiUJ5xRo.js";import{d as K,s as R,a as j,u as J,r as h,b as O,c as W,f as X,w as r,g as i,h as d,k as t,l as m,m as k,n as v,q as Z,F as C,x as s,t as c,z as I,A as ee,K as te,L as ae,_ as oe}from"./index-DkzAPJNB.js";import{t as se}from"./toArray-C_Xi04os.js";const ne={class:"d-flex"},le={class:"ml-auto"},ce={class:"table"},re={key:0},ie=["colspan"],de={class:"detail"},ue={key:0},pe={scope:"row"},me={scope:"row"},ve={class:"cmQuest"},_e={scope:"row"},he={key:1},ge={scope:"row"},xe={scope:"row"},ye={scope:"row"},fe=K({__name:"DataView",setup(be){const{token:V}=R(j()),{DataTable1:M,DataTable:u,DataTable1Mobile:T}=q(),{axiosIns:y}=J(),{StateText:Y,StateColor:B,FormatGender:F,FormatPosition:L,DateText:f}=E(),p=h([]),g=h(1),l=h({ItemPerPage:15,ItemsLength:0,Items:[],Loading:!1,Search:"",Title:"資料統計",CodeSet:[]}),S=h([]),x=h(""),U=O(),w=W(()=>U.xs.value?T:M),b={headers:{Authorization:`Bearer ${V.value}`}},D=async()=>{await y.get("Counseling/master/data",{params:{Year:x.value},...b}).then(e=>l.value.Items=e.data).catch(e=>console.log(e)),l.value.Items.length&&te(l.value.Items).pipe(ae(e=>({...e,gender:F(e.gender),position:L(e.position),applyDate:f(e.applyDate,e.cmState),contactDate:f(e.contactDate,e.cmState),closeDate:f(e.closeDate,e.cmState)})),se()).subscribe({next:e=>{l.value.Items=e},error:e=>console.error(e)}),l.value.Loading=!1},z=async()=>{await y.get("api/CodeSet/CMState",b).then(e=>l.value.CodeSet=e.data).catch(()=>{l.value.CodeSet=[]})},A=async()=>{await y.get("Counseling/master/MaxMinYear",b).then(e=>{const o=e.data;x.value=o.minYear;let _=parseInt(o.minYear);do S.value.push(_.toString()),_++;while(_<=parseInt(o.maxYear));D()}).catch(e=>console.log(e))};return z(),A(),(e,o)=>{const _=i("v-select"),G=i("v-toolbar-title"),N=i("v-toolbar"),$=i("v-btn"),H=i("v-pagination"),P=i("v-data-table"),Q=i("v-container");return d(),X(Q,{fluid:""},{default:r(()=>[t("div",ne,[t("div",le,[m(_,{modelValue:x.value,"onUpdate:modelValue":[o[0]||(o[0]=a=>x.value=a),o[1]||(o[1]=a=>D())],items:S.value,density:"compact","bg-color":"white",width:"150px",variant:"outlined","prepend-inner-icon":"mdi-magnify"},null,8,["modelValue","items"])])]),m(P,{style:{height:"80vh"},"items-per-page":"15",expanded:p.value,"onUpdate:expanded":o[3]||(o[3]=a=>p.value=a),page:g.value,"onUpdate:page":o[4]||(o[4]=a=>g.value=a),headers:w.value,items:l.value.Items,"item-value":"cmid","show-expand":"",sticky:!0},{top:r(()=>[m(N,{flat:""},{default:r(()=>[m(G,{class:"font-weight-bold text-center text-sm-h5"},{default:r(()=>[k("歷年諮申請紀錄表")]),_:1})]),_:1})]),item:r(({item:a})=>[t("tr",ce,[(d(!0),v(C,null,Z(w.value,n=>(d(),v("td",{key:n.key},[n.key==="data-table-expand"?(d(),v("span",re,[m($,{icon:p.value[0]==a.cmid?"mdi-chevron-up":"mdi-chevron-down",variant:"text",size:"small",onClick:()=>p.value[0]==a.cmid?p.value=[]:p.value=[a.cmid]},null,8,["icon","onClick"])])):(d(),v(C,{key:1},[k(s(a[n.key]),1)],64))]))),128))])]),"expanded-row":r(({columns:a,item:n})=>[t("tr",null,[t("td",{colspan:a.length,class:"pa-0"},[t("table",de,[e.$vuetify.display.xs?(d(),v("tr",ue,[t("th",pe,s(c(u)[4].title),1),t("td",null,s(n.position),1)])):I("",!0),t("tr",null,[t("th",me,s(c(u)[5].title),1),t("td",null,[t("div",ve,s(n.cmQuest),1)])]),t("tr",null,[t("th",_e,s(c(u)[6].title),1),t("td",{style:ee({color:c(B)(n.cmState)})},s(c(Y)(n.cmState,l.value.CodeSet)),5)]),e.$vuetify.display.xs?(d(),v("tr",he,[t("th",ge,s(c(u)[8].title),1),t("td",null,s(n.applyDate),1)])):I("",!0),t("tr",null,[t("th",xe,s(c(u)[9].title),1),t("td",null,s(n.contactDate),1)]),t("tr",null,[t("th",ye,s(c(u)[10].title),1),t("td",null,s(n.closeDate),1)])])],8,ie)])]),bottom:r(()=>[m(H,{modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=a=>g.value=a),length:Math.ceil(l.value.Items.length/15),"total-visible":3},null,8,["modelValue","length"])]),_:1},8,["expanded","page","headers","items"])]),_:1})}}}),ke=oe(fe,[["__scopeId","data-v-c5b21b81"]]);export{ke as default};
