import{d as K,u as O,s as Q,a as X,b as Y,c as N,r as h,o as Z,e as ee,B as te,f as ae,w as n,p as oe,g as d,h as u,i as se,v as le,k as o,l as s,m as A,n as m,q as ne,F as M,t as x,x as S,y as z,z as ie,A as ce,_ as de}from"./index-DkzAPJNB.js";import{C as D}from"./CounMasterInfo-PZ6IITpm.js";import{S as ue}from"./SearchText-7uKoE6o6.js";import{u as re,H as ve}from"./TableHeader-CiUJ5xRo.js";const me={class:"SearchPosition"},pe={class:"d-flex"},_e={class:"ml-auto mb-2"},ge={class:"text-center table"},he={key:1},xe={key:2},Se={key:0},fe=["colspan"],be={class:"detail"},ye=["colspan"],Ie=["colspan"],Ce={colspan:"2",class:"text-end"},we=K({__name:"IndexView2",setup(ke){const{CTable1:b,CTableMobile1:U}=ve(),{axiosIns:P}=O(),{token:F}=Q(X()),{StateColor:G,StateText:H,debounce:R}=re(),y=Y(),V=N(()=>y.xs.value?U:b),p=h([]),t=h({ItemPerPage:20,ItemsLength:0,Items:[],Loading:!1,Search:"",Title:"待處理列表",Width:"450px",CodeSet:[]}),r=h({userName:"",cmstate:null}),_=h(1),L=h([]),W=N(()=>[{title:"全部",value:null},...[...t.value.CodeSet].filter(a=>a.code==="1"||a.code==="2").map(a=>({title:a.word,value:a.code}))]),I=h(!1);Z(()=>{setTimeout(()=>{I.value=!0},600)}),ee(()=>{I.value=!1});const T={headers:{Authorization:`Bearer ${F.value}`}},B=async(a,l,C,f)=>{var g;const w={PageIndex:a,PageSize:l,UserName:f.userName,CMState:f.cmstate,SortBy:(g=C[0])==null?void 0:g.order};await P.get("Counseling/master/PendingTable",{params:w,...T}).then(v=>{t.value.Items=v.data.counMasterTable,t.value.ItemsLength=v.data.counMasterTableCount}).catch(v=>{console.log(v),t.value.Items=[],t.value.ItemsLength=t.value.Items.length}),t.value.Loading=!1};(async()=>{await P.get("api/CodeSet/CMState",T).then(a=>t.value.CodeSet=a.data).catch(()=>{t.value.CodeSet=[]})})(),oe("uploadData",()=>B(_.value,t.value.ItemPerPage,L.value,r.value));const q=a=>{t.value.Loading=!0,t.value.Items=[],E(a)},E=R(a=>{_.value=a.page,t.value.ItemPerPage=a.itemsPerPage,L.value=a.sortBy,B(a.page,a.itemsPerPage,a.sortBy,r.value)},500);return te(r.value,()=>{t.value.Search=Date.now().toString()},{deep:!0}),(a,l)=>{const C=d("v-select"),f=d("v-toolbar-title"),w=d("v-toolbar"),g=d("v-btn"),v=d("v-dialog"),$=d("v-pagination"),j=d("v-data-table-server"),J=d("v-container");return u(),ae(J,{fluid:""},{default:n(()=>[se(o("div",me,[s(ue,{modelValue:r.value.userName,"onUpdate:modelValue":l[0]||(l[0]=e=>r.value.userName=e)},null,8,["modelValue"])],512),[[le,I.value]]),o("div",pe,[o("div",_e,[s(C,{modelValue:r.value.cmstate,"onUpdate:modelValue":l[1]||(l[1]=e=>r.value.cmstate=e),width:"150px","bg-color":"white","hide-details":"",label:"狀態分類",variant:"outlined",density:"compact",items:W.value,"item-title":"title","item-value":"value"},null,8,["modelValue","items"])])]),s(j,{style:{height:"80vh"},items:t.value.Items,expanded:p.value,"onUpdate:expanded":l[3]||(l[3]=e=>p.value=e),page:_.value,"onUpdate:page":l[4]||(l[4]=e=>_.value=e),"items-length":t.value.ItemsLength,"items-per-page":"20","item-value":"cmid",headers:V.value,search:t.value.Search,"onUpdate:options":q,sticky:"",class:"table-sticky",loading:t.value.Loading,"show-expand":x(y).xs.value},{top:n(()=>[s(w,{flat:""},{default:n(()=>[s(f,{class:"font-weight-bold text-center text-sm-h5"},{default:n(()=>[A("待處理申請列表")]),_:1})]),_:1})]),item:n(({item:e})=>[o("tr",ge,[(u(!0),m(M,null,ne(V.value,i=>(u(),m("td",{key:i.key},[i.key==="cmState"?(u(),m("span",{key:0,style:ce({color:x(G)(e.cmState)})},S(x(H)(e.cmState,t.value.CodeSet)),5)):i.key==="action"?(u(),m("span",he,[s(v,{activator:"parent",persistent:"","max-width":"1000px"},{activator:n(({props:c})=>[s(g,z({size:"small",color:"info",text:"查看",ref_for:!0},c),null,16)]),default:n(({isActive:c})=>[s(D,{id:e.cmid,isActive:c.value,onIsActive:k=>c.value=k},null,8,["id","isActive","onIsActive"])]),_:2},1024)])):i.key==="data-table-expand"?(u(),m("span",xe,[s(g,{icon:p.value[0]==e.cmid?"mdi-chevron-up":"mdi-chevron-down",variant:"text",size:"small",onClick:()=>p.value[0]==e.cmid?p.value=[]:p.value=[e.cmid]},null,8,["icon","onClick"])])):(u(),m(M,{key:3},[A(S(e[i.key]),1)],64))]))),128))])]),"expanded-row":n(({columns:e,item:i})=>[x(y).xs.value?(u(),m("tr",Se,[o("td",{colspan:e.length,class:"pa-0"},[o("table",be,[o("tr",null,[o("th",null,S(x(b)[1].title),1),o("td",{colspan:e.length-1},S(i.userName),9,ye)]),o("tr",null,[o("th",null,S(x(b)[2].title),1),o("td",{colspan:e.length-1},S(i.topics),9,Ie)]),o("tr",null,[o("td",Ce,[s(v,{activator:"parent",persistent:"","max-width":"1000px"},{activator:n(({props:c})=>[s(g,z({size:"small",color:"info",text:"查看"},c),null,16)]),default:n(({isActive:c})=>[s(D,{id:i.cmid,isActive:c.value,onIsActive:k=>c.value=k},null,8,["id","isActive","onIsActive"])]),_:2},1024)])])])],8,fe)])):ie("",!0)]),bottom:n(()=>[s($,{modelValue:_.value,"onUpdate:modelValue":l[2]||(l[2]=e=>_.value=e),length:Math.ceil(t.value.ItemsLength/20),"total-visible":3},null,8,["modelValue","length"])]),_:1},8,["items","expanded","page","items-length","headers","search","loading","show-expand"])]),_:1})}}}),Ne=de(we,[["__scopeId","data-v-1b26cc20"]]);export{Ne as default};
