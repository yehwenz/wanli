import{d as oe,s as se,a as ie,u as ue,D as fe,r as d,c as re,g as o,C as de,h as f,n as B,l as e,w as t,k as _,x as U,A as ce,i as O,f as $,m as G,z as J,t as h,V as ge,y as R,F as le,_ as ve,b as xe,o as ye,e as he,p as ke,K as be,L as we,v as ne,q as Ce}from"./index-DkzAPJNB.js";import{u as Ie,H as Ve}from"./TableHeader-CiUJ5xRo.js";import{R as Me}from"./customerFormRules-rWLVaX5W.js";import{M as Ue,S as $e}from"./SearchText-7uKoE6o6.js";import{t as Ee}from"./toArray-C_Xi04os.js";const Se=_("br",null,null,-1),ae=oe({__name:"EditUser2",props:{isEdit:{type:Boolean},uid:{}},emits:["isEdit"],setup(Q,{emit:K}){const E=Q,F=K,{required:w}=Me(),{token:H}=se(ie()),{axiosIns:b}=ue(),N=fe("uploadData"),x=d(!1),C=d(""),k=d(""),y=d(),I=d(),s=d(!1),D=re(()=>E.uid?"編輯成員":"新增成員"),T=d(),i=d({uid:0,userid:"",userName:"",role:null,enable:null,expire:null,memo:null}),z=d([]),P=[{title:"啟用",value:"Y"},{title:"禁用",value:"N"}],M={headers:{Authorization:`Bearer ${H.value}`}};(async l=>{l&&await b.get(`Counseling/CounManage/Detail/${l}`,M).then(a=>i.value=a.data).catch(a=>{x.value=!1,s.value=!0,k.value="錯誤",C.value=a.message,I.value="error",y.value="mdi-close-circle"})})(E.uid),(async()=>{await b.get("api/CodeSet/CMRole",M).then(l=>z.value=l.data).catch(l=>{x.value=!1,s.value=!0,k.value="錯誤",C.value=l.message,I.value="error",y.value="mdi-close-circle"})})();const W=async()=>{var a;const l=await((a=T.value)==null?void 0:a.validate());l!=null&&l.valid&&await b.post("Counseling/CounManage",i.value,M).then(()=>{x.value=!0,s.value=!0,k.value="成功",C.value="新增成員成功!",I.value="success",y.value="mdi-check-circle"}).catch(S=>{var c;x.value=!0,s.value=!1,k.value="錯誤",C.value=(c=S.response)==null?void 0:c.data,I.value="error",y.value="mdi-close-circle"})},X=async()=>{var a;const l=await((a=T.value)==null?void 0:a.validate());l!=null&&l.valid&&await b.put("Counseling/CounManage",i.value,M).then(()=>{x.value=!0,s.value=!0,k.value="成功",C.value="更新成員成功!",I.value="success",y.value="mdi-check-circle"}).catch(S=>{var c;x.value=!0,s.value=!1,k.value="錯誤",C.value=((c=S.response)==null?void 0:c.data)||"發生不可預期之錯誤，請告知開發人員!",I.value="error",y.value="mdi-close-circle"})};return(l,a)=>{const S=o("v-icon"),c=o("v-card-title"),p=o("v-divider"),L=o("v-alert"),j=o("v-slide-y-transition"),g=o("v-text-field"),v=o("v-col"),A=o("v-select"),Z=o("v-textarea"),ee=o("v-row"),te=o("v-card-text"),n=o("v-spacer"),m=o("v-btn"),u=o("v-card"),V=o("v-dialog"),pe=o("v-card-actions"),me=de("tooltip");return f(),B(le,null,[e(u,null,{default:t(()=>[e(c,null,{default:t(()=>[_("div",{class:"text-center",style:ce({fontSize:l.$vuetify.display.xs?"25px":"30px"})},U(D.value),5),O((f(),$(S,{class:"position-absolute top-0 right-0 ma-3",onClick:a[0]||(a[0]=r=>F("isEdit",!l.isEdit))},{default:t(()=>[G("mdi-close")]),_:1})),[[me,"關閉","bottom"]])]),_:1}),e(p),e(te,{style:{"max-height":"600px"},class:"overflow-y-auto"},{default:t(()=>[e(j,null,{default:t(()=>[l.uid?J("",!0):(f(),$(L,{key:0,type:"warning",title:"提示",closable:""},{default:t(()=>[G(" 1.若要新增管理者，只能使用學校的帳號新增，例:example"),Se,G(" 2.若要用google登入，只能使用學校的google帳號新增，例:example@stust.edu.tw ")]),_:1}))]),_:1}),e(h(ge),{ref_key:"form",ref:T,class:"mt-10"},{default:t(()=>[e(ee,{"no-gutters":l.$vuetify.display.xs},{default:t(()=>[e(v,{cols:"12",sm:"4"},{default:t(()=>[e(g,{modelValue:i.value.userid,"onUpdate:modelValue":a[1]||(a[1]=r=>i.value.userid=r),label:"帳號",variant:"outlined",hint:"如為學校帳號，則只需輸入@之前的字串。",rules:[h(w)],density:l.$vuetify.display.smAndUp?"default":"compact",readonly:!!l.uid},null,8,["modelValue","rules","density","readonly"])]),_:1}),e(v,{cols:"12",sm:"4"},{default:t(()=>[e(g,{modelValue:i.value.userName,"onUpdate:modelValue":a[2]||(a[2]=r=>i.value.userName=r),label:"姓名",variant:"outlined",rules:[h(w)],density:l.$vuetify.display.smAndUp?"default":"compact"},null,8,["modelValue","rules","density"])]),_:1}),e(v,{cols:"12",sm:"4"},{default:t(()=>[e(A,{modelValue:i.value.role,"onUpdate:modelValue":a[3]||(a[3]=r=>i.value.role=r),label:"角色",items:z.value,"item-title":"word","item-value":"code",variant:"outlined",rules:[h(w)],density:l.$vuetify.display.smAndUp?"default":"compact"},null,8,["modelValue","items","rules","density"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:t(()=>[e(A,{modelValue:i.value.enable,"onUpdate:modelValue":a[4]||(a[4]=r=>i.value.enable=r),label:"啟用模式",items:P,"item-title":"title","item-value":"value",variant:"outlined",rules:[h(w)],density:l.$vuetify.display.smAndUp?"default":"compact"},null,8,["modelValue","rules","density"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:t(()=>[e(Ue,{newText:"到期日",variant:"outlined",rule:[h(w)],value:i.value.expire,mode:"input",onSelectDate:a[5]||(a[5]=r=>i.value.expire=r),density:l.$vuetify.display.smAndUp?"default":"compact"},null,8,["rule","value","density"])]),_:1}),e(v,{cols:"12"},{default:t(()=>[e(Z,{"no-resize":"",label:"備註",modelValue:i.value.memo,"onUpdate:modelValue":a[6]||(a[6]=r=>i.value.memo=r),density:l.$vuetify.display.smAndUp?"default":"compact"},null,8,["modelValue","density"])]),_:1})]),_:1},8,["no-gutters"])]),_:1},512)]),_:1}),e(pe,null,{default:t(()=>[e(n),e(V,{persistent:"","max-width":"400px",transition:"scroll-x-reverse-transition"},{activator:t(({props:r})=>[l.uid?(f(),$(m,R({key:0,class:"font-weight-bold","prepend-icon":"mdi-upload",text:"修改",variant:"elevated",color:"#90CAF9"},r),null,16)):J("",!0)]),default:t(({isActive:r})=>[e(u,{"prepend-icon":"mdi-alert-circle",title:"修改",text:"確定要修改嗎?",color:"warning"},{actions:t(()=>[e(m,{variant:"flat",text:"cancel",onClick:_e=>r.value=!1},null,8,["onClick"]),e(m,{variant:"flat",text:"ok",onClick:_e=>{r.value=!1,X()},color:"info"},null,8,["onClick"])]),_:2},1024)]),_:1}),l.uid?J("",!0):(f(),$(m,{key:0,class:"font-weight-bold","prepend-icon":"mdi-plus-box",text:"新增",variant:"elevated",color:"#90CAF9",onClick:W}))]),_:1})]),_:1}),e(V,{persistent:"",modelValue:x.value,"onUpdate:modelValue":a[9]||(a[9]=r=>x.value=r),"max-width":"500px"},{default:t(()=>[e(u,{"prepend-icon":y.value,title:k.value,text:C.value,color:I.value},{actions:t(()=>[s.value?(f(),$(m,{key:0,variant:"elevated",color:"white",text:"ok",onClick:a[7]||(a[7]=r=>{h(N)&&h(N)(),x.value=!1,F("isEdit",!1)})})):(f(),$(m,{key:1,text:"ok",variant:"elevated",color:"white",onClick:a[8]||(a[8]=r=>x.value=!1)}))]),_:1},8,["prepend-icon","title","text","color"])]),_:1},8,["modelValue"])],64)}}}),Le=oe({__name:"AddMember",setup(Q){return(K,E)=>{const F=o("v-icon"),w=o("v-dialog"),H=de("tooltip");return f(),$(w,{width:"750px",transition:"scroll-x-reverse-transition"},{activator:t(({props:b})=>[O((f(),$(F,R({class:"addMemberIcon",color:"white"},b),{default:t(()=>[G("mdi-account-multiple-plus")]),_:2},1040)),[[H,"新增成員"]])]),default:t(({isActive:b})=>[e(ae,{isEdit:b.value,uid:null,onIsEdit:N=>b.value=N},null,8,["isEdit","onIsEdit"])]),_:1})}}}),Ae=ve(Le,[["__scopeId","data-v-a591aa27"]]),Be={class:"SearchPosition"},De={class:"table"},Te={key:1},ze={key:2},Fe={key:0},Ne=["colspan"],Pe={class:"detail"},Re=["colspan"],Ge=oe({__name:"IndexView2",setup(Q){const{token:K}=se(ie()),{RoleListTable1:E,RoleListTable1Mobile:F}=Ve(),{axiosIns:w}=ue(),{FormatEnable:H,debounce:b,FormatDate:N}=Ie(),x=xe(),C=re(()=>x.xs.value?F:E),k=d(""),y=d([]),I=d(1),s=d({ItemsLength:0,Items:[],Loading:!1}),D=d(1),T=d([]),i=d(!1),z=d(""),P=d(""),M=d(),q=d(),Y=d(!1);ye(()=>{setTimeout(()=>{Y.value=!0},600)}),he(()=>{Y.value=!1}),ke("uploadData",()=>l({page:D.value,itemsPerPage:20,sortBy:T.value,search:k.value}));const W={headers:{Authorization:`Bearer ${K.value}`}},X=async(c,p,L)=>{var g;const j={PageIndex:c,PageSize:20,UserName:L,SortBy:(g=p[0])==null?void 0:g.order};await w.get("Counseling/CounManageTable",{params:j,...W}).then(v=>{s.value.Items=v.data.counManageTable,s.value.ItemsLength=v.data.counManageTableCount}).catch(()=>{s.value.Items=[],s.value.ItemsLength=s.value.Items.length}),s.value.Items.length&&be(s.value.Items).pipe(we(v=>({...v,expire:N(v.expire)})),Ee()).subscribe({next:v=>{s.value.Items=v},error:v=>console.error(v)}),s.value.Loading=!1},l=c=>{s.value.Loading=!0,s.value.Items=[],a(c)},a=b(c=>{D.value=c.page,T.value=c.sortBy,X(c.page,c.sortBy,c.search)},700),S=async c=>{await w.delete("Counseling/CounManage",{params:{uid:c},...W}).then(()=>{i.value=!0,z.value="刪除成功!",P.value="成功",M.value="mdi-check-circle",q.value="success"}).catch(p=>{var L;switch((L=p.response)==null?void 0:L.status){case 400:i.value=!0,z.value=`${p.response.data}`,P.value="錯誤",M.value="mdi-close-circle",q.value="error";break;default:i.value=!0,z.value="發生不可預期的狀況，請告知開發者!",P.value="錯誤",M.value="mdi-close-circle",q.value="error";break}})};return(c,p)=>{const L=o("v-toolbar-title"),j=o("v-toolbar"),g=o("v-btn"),v=o("v-card"),A=o("v-dialog"),Z=o("v-pagination"),ee=o("v-data-table-server"),te=o("v-container");return f(),$(te,{fluid:""},{default:t(()=>[O(_("div",Be,[e($e,{modelValue:k.value,"onUpdate:modelValue":p[0]||(p[0]=n=>k.value=n)},null,8,["modelValue"])],512),[[ne,Y.value]]),O(_("div",null,[e(Ae)],512),[[ne,Y.value]]),e(ee,{expanded:y.value,"onUpdate:expanded":p[2]||(p[2]=n=>y.value=n),page:D.value,"onUpdate:page":p[3]||(p[3]=n=>D.value=n),headers:C.value,items:s.value.Items,"items-per-page":"20","item-value":"uid","items-length":s.value.ItemsLength,loading:s.value.Loading,search:k.value,"onUpdate:options":l,"show-expand":!!h(x).xs.value,class:"table-sticky",style:{height:"85vh"},sticky:""},{top:t(()=>[e(j,{flat:""},{default:t(()=>[e(L,{class:"font-weight-bold text-center text-sm-h5"},{default:t(()=>[G("角色管理表")]),_:1})]),_:1})]),item:t(({item:n})=>[_("tr",De,[(f(!0),B(le,null,Ce(C.value,m=>(f(),B("td",{key:m.key},[m.key==="enable"?(f(),B("span",{key:0,style:ce({color:n.enable==="Y"?"green":"red"})},U(h(H)(n.enable)),5)):m.key==="action"?(f(),B("span",Te,[e(A,{persistent:"","max-width":"400px",transition:"scroll-x-reverse-transition"},{activator:t(({props:u})=>[e(g,R({text:"刪除",ref_for:!0},u,{color:"#EF9A9A",size:"small",rounded:"pill"}),null,16)]),default:t(({isActive:u})=>[e(v,{"prepend-icon":"mdi-alert-circle",title:"刪除",text:"確定要刪除使用者嗎?",color:"warning"},{actions:t(()=>[e(g,{variant:"flat",text:"cancel",onClick:V=>u.value=!1},null,8,["onClick"]),e(g,{variant:"flat",text:"ok",onClick:V=>S(n.uid),color:"red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024),e(A,{persistent:"","max-width":"750px",transition:"scroll-x-reverse-transition"},{activator:t(({props:u})=>[e(g,R({text:"修改",ref_for:!0},u,{color:"#90CAF9",size:"small",class:"btn-ma"}),null,16)]),default:t(({isActive:u})=>[e(ae,{isEdit:u.value,uid:n.uid,onIsEdit:V=>u.value=V},null,8,["isEdit","uid","onIsEdit"])]),_:2},1024)])):m.key==="data-table-expand"?(f(),B("span",ze,[e(g,{icon:y.value[0]==n.uid?"mdi-chevron-up":"mdi-chevron-down",variant:"text",size:"small",onClick:()=>y.value[0]==n.uid?y.value=[]:y.value=[n.uid]},null,8,["icon","onClick"])])):(f(),B(le,{key:3},[G(U(n[m.key]),1)],64))]))),128))])]),"expanded-row":t(({columns:n,item:m})=>[h(x).xs.value?(f(),B("tr",Fe,[_("td",{colspan:n.length,class:"pa-0"},[_("table",Pe,[_("tr",null,[_("th",null,U(h(E)[1].title),1),_("td",null,U(m.userName),1)]),_("tr",null,[_("th",null,U(h(E)[2].title),1),_("td",null,U(m.role),1)]),_("tr",null,[_("th",null,U(h(E)[3].title),1),_("td",null,U(m.expire),1)]),_("tr",null,[_("td",{colspan:n.length,class:"text-end"},[e(A,{persistent:"","max-width":"400px",transition:"scroll-x-reverse-transition"},{activator:t(({props:u})=>[e(g,R({text:"刪除"},u,{color:"#EF9A9A",size:"small",rounded:"pill"}),null,16)]),default:t(({isActive:u})=>[e(v,{"prepend-icon":"mdi-alert-circle",title:"刪除",text:"確定要刪除使用者嗎?",color:"warning"},{actions:t(()=>[e(g,{variant:"flat",text:"cancel",onClick:V=>u.value=!1},null,8,["onClick"]),e(g,{variant:"flat",text:"ok",onClick:V=>S(m.uid),color:"red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024),e(A,{persistent:"","max-width":"750px",transition:"scroll-x-reverse-transition"},{activator:t(({props:u})=>[e(g,R({text:"修改"},u,{color:"#90CAF9",class:"ml-4",size:"small"}),null,16)]),default:t(({isActive:u})=>[e(ae,{isEdit:u.value,uid:m.uid,onIsEdit:V=>u.value=V},null,8,["isEdit","uid","onIsEdit"])]),_:2},1024)],8,Re)])])],8,Ne)])):J("",!0)]),bottom:t(()=>[e(Z,{modelValue:I.value,"onUpdate:modelValue":p[1]||(p[1]=n=>I.value=n),length:Math.ceil(s.value.ItemsLength/20),"total-visible":3},null,8,["modelValue","length"])]),_:1},8,["expanded","page","headers","items","items-length","loading","search","show-expand"]),e(A,{persistent:"",modelValue:i.value,"onUpdate:modelValue":p[5]||(p[5]=n=>i.value=n),"max-width":"500px"},{default:t(()=>[e(v,{"prepend-icon":M.value,title:P.value,text:z.value,color:q.value},{actions:t(()=>[e(g,{text:"ok",variant:"elevated",color:"white",onClick:p[4]||(p[4]=n=>{l({page:D.value,itemsPerPage:10,sortBy:T.value,search:k.value}),i.value=!1})})]),_:1},8,["prepend-icon","title","text","color"])]),_:1},8,["modelValue"])]),_:1})}}}),We=ve(Ge,[["__scopeId","data-v-5e676e81"]]);export{We as default};
